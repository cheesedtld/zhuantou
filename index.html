<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Â∞èÊâãÊú∫</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.loli.net">
    <link rel="preconnect" href="https://gstatic.loli.net" crossorigin>
    <link href="https://fonts.loli.net/css2?family=Dancing+Script:wght@700&family=Ma+Shan+Zheng&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
    <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0"
  }
}
</script>
</head>

<body>
    <div id="phone-container">
        <div class="status-bar text-dark" id="status-bar">
            <div class="sb-left" id="clock">12:00</div>
            <div class="sb-right">
                <svg width="22" height="11" viewBox="0 0 22 11" fill="currentColor">
                    <path d="M4 5 l1.5 2.5 h-3 z" />
                    <path d="M4 11 l-1.5 -2.5 h3 z" />
                    <path d="M7 5.5h2v6H7v-6zm4-3h2v9H11v-9zm4-3h2v12h-2V-.5z"></path>
                </svg>
                <svg id="battery-icon" width="22" height="11" viewBox="0 0 25 11" fill="currentColor">
                    <rect x="0.5" y="0.5" width="20" height="10" rx="2.5" stroke="currentColor" fill="none"></rect>
                    <path d="M23 4v3" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
                    <rect id="battery-fill" x="2.5" y="2.5" width="16" height="6" rx="1" fill="currentColor"></rect>
                </svg>
            </div>
        </div>
        <div id="home-screen" class="screen">
            <div id="home-clock">12:00</div>
            <div class="app-grid">
                <div class="app-item" onclick="openMessageList()">
                    <div class="app-icon-box app-icon-style">
                        <div class="app-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/basil:wechat-solid.svg'); mask-image: url('https://api.iconify.design/basil:wechat-solid.svg');">
                        </div>
                    </div>
                    <span class="app-name">ËÅäÂ§©</span>
                </div>
                <div class="app-item">
                    <div class="app-icon-box app-icon-style">
                        <div class="app-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/material-symbols:forum-rounded.svg'); mask-image: url('https://api.iconify.design/material-symbols:forum-rounded.svg');">
                        </div>
                    </div>
                    <span class="app-name">ËÆ∫Âùõ</span>
                </div>
                <div class="app-item">
                    <div class="app-icon-box app-icon-style">
                        <div class="app-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/fa-brands:discord.svg'); mask-image: url('https://api.iconify.design/fa-brands:discord.svg');">
                        </div>
                    </div>
                    <span class="app-name">Discord</span>
                </div>

                <div class="app-item" onclick="openUserSettings()">
                    <div class="app-icon-box app-icon-style">
                        <div class="app-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/tabler:mood-edit.svg'); mask-image: url('https://api.iconify.design/tabler:mood-edit.svg');">
                        </div>
                    </div>
                    <span class="app-name">userËÆæÁΩÆ</span>
                </div>
                <div class="app-item" onclick="openCharacterSetup('world')">
                    <div class="app-icon-box app-icon-style">
                        <div class="app-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/bxs:book-heart.svg'); mask-image: url('https://api.iconify.design/bxs:book-heart.svg');">
                        </div>
                    </div>
                    <span class="app-name">‰∏ñÁïå‰π¶</span>
                </div>
                <div class="app-item" onclick="openNpcSettings()">
                    <div class="app-icon-box app-icon-style">
                        <div class="app-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/game-icons:love-mystery.svg'); mask-image: url('https://api.iconify.design/game-icons:love-mystery.svg');">
                        </div>
                    </div>
                    <span class="app-name">ËßíËâ≤ËÆæÁΩÆ</span>
                </div>
                <div class="app-item" onclick="openSettings()">
                    <div class="app-icon-box app-icon-style"><svg viewBox="0 0 24 24">
                            <path
                                d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L3.16 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z">
                            </path>
                        </svg></div>
                    <span class="app-name">ËÆæÁΩÆ</span>
                </div>
                <div class="app-item" onclick="openRegexScreen()">
                    <div class="app-icon-box app-icon-style">
                        <div class="app-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/tabler:regex.svg'); mask-image: url('https://api.iconify.design/tabler:regex.svg');">
                        </div>
                    </div>
                    <span class="app-name">Ê≠£Âàô</span>
                </div>
            </div>
        </div>
        <div id="message-list-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="goBack()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">Ê∂àÊÅØ</span>
                    <div class="header-btn header-btn-right" onclick="showAddActionSheet()"><svg viewBox="0 0 24 24">
                            <path d="M12 5v14M5 12h14" stroke="#181818" stroke-width="2" stroke-linecap="round"></path>
                        </svg></div>
                </div>
            </div>
            <div class="message-list-body" id="message-list-body">
                <!-- ÂàóË°®È°πÂ∞ÜÁî± JS Âä®ÊÄÅÁîüÊàê -->
            </div>
            <div id="bottom-nav">
                <div class="nav-item active">
                    <div class="nav-icon">
                        <div class="nav-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/tabler:message-circle-2.svg'); mask-image: url('https://api.iconify.design/tabler:message-circle-2.svg');">
                        </div>
                    </div>
                    <div class="nav-label">Ê∂àÊÅØ</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">
                        <div class="nav-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/iconoir:compass.svg'); mask-image: url('https://api.iconify.design/iconoir:compass.svg');">
                        </div>
                    </div>
                    <div class="nav-label">Âä®ÊÄÅ</div>
                </div>
                <div class="nav-item">
                    <div class="nav-icon">
                        <div class="nav-icon-image"
                            style="-webkit-mask-image: url('https://api.iconify.design/clarity:avatar-line.svg'); mask-image: url('https://api.iconify.design/clarity:avatar-line.svg');">
                        </div>
                    </div>
                    <div class="nav-label">Êàë</div>
                </div>
            </div>
        </div>
        <div id="chat-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="goBack()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title" id="header-title"></span>
                    <div class="header-btn header-btn-right" onclick="openChatSettings()"><svg viewBox="0 0 24 24">
                            <circle cx="6" cy="12" r="1.6" fill="#181818"></circle>
                            <circle cx="12" cy="12" r="1.6" fill="#181818"></circle>
                            <circle cx="18" cy="12" r="1.6" fill="#181818"></circle>
                        </svg></div>
                </div>
            </div>
            <div id="chat-messages"></div>
            <div id="love-effect-layer" class="love-effect-container"></div>

            <!-- ÂºïÁî®Ê∂àÊÅØÈ¢ÑËßàÊù° -->
            <div id="quote-preview-bar">
                <div class="quote-preview-content">
                    <div class="quote-preview-name" id="quote-preview-name"></div>
                    <div class="quote-preview-text" id="quote-preview-text"></div>
                </div>
                <div class="quote-preview-close" onclick="cancelQuote()">√ó</div>
            </div>

            <!-- Â™í‰ΩìÈ¢ÑËßàÊù° -->
            <div id="media-preview-bar">
                <div class="preview-item">
                    <img id="preview-image" src="" style="display:none">
                    <div id="preview-file-icon" class="preview-file-icon" style="display:none">üéµ</div>
                    <div class="preview-close" onclick="clearPreview()">√ó</div>
                </div>
            </div>

            <div id="input-bar">
                <button id="plus-button" class="toolbar-btn" title="Êõ¥Â§öÂäüËÉΩ"><svg viewBox="0 0 24 24">
                        <path d="M12 5v14M5 12h14" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg></button>
                <button id="emoji-button" class="toolbar-btn"><svg viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M8 14s1.5 2 4 2 4-2 4-2"></path>
                        <line x1="9" y1="9" x2="9.01" y2="9" stroke-width="2" stroke-linecap="round"></line>
                        <line x1="15" y1="9" x2="15.01" y2="9" stroke-width="2" stroke-linecap="round"></line>
                    </svg></button>
                <textarea id="message-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." rows="1"></textarea>
                <button id="send-button">ÂèëÈÄÅ</button>
            </div>
            <input type="file" id="photo-upload-input" accept="image/*" style="display: none;">
            <input type="file" id="audio-upload-input" accept="audio/*" style="display: none;">
            <input type="file" id="video-upload-input" accept="video/*" style="display: none;">
            <input type="file" id="settings-file-input" accept="image/*" style="display: none;">
            <div id="action-menu">
                <div class="action-item" onclick="handleAction('photo')">
                    <div class="action-icon-box"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#333" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg></div><span>ÁÖßÁâá</span>
                </div>
                <div class="action-item" onclick="handleAction('voice')">
                    <div class="action-icon-box"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#333" stroke-width="1.5">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg></div><span>ËØ≠Èü≥</span>
                </div>
                <div class="action-item" onclick="handleAction('call')">
                    <div class="action-icon-box"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#333" stroke-width="1.5">
                            <path
                                d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z">
                            </path>
                        </svg></div><span>ÈÄöËØù</span>
                </div>
                <div class="action-item" onclick="handleAction('camera')">
                    <div class="action-icon-box"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#333" stroke-width="1.5">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z">
                            </path>
                            <circle cx="12" cy="13" r="4"></circle>
                        </svg></div><span>Áõ∏Êú∫</span>
                </div>
                <div class="action-item" onclick="handleAction('location')">
                    <div class="action-icon-box"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#333" stroke-width="1.5">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg></div><span>‰ΩçÁΩÆ</span>
                </div>
                <div class="action-item" onclick="handleAction('transfer')">
                    <div class="action-icon-box"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#333" stroke-width="1.5">
                            <path d="M7 10h14l-4-4"></path>
                            <path d="M17 14H3l4 4"></path>
                        </svg></div><span>ËΩ¨Ë¥¶</span>
                </div>
                <div class="action-item" onclick="handleAction('file')">
                    <div class="action-icon-box"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="#333" stroke-width="1.5">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg></div><span>Êñá‰ª∂</span>
                </div>
            </div>
            <div id="emoji-menu"></div>
        </div>
        <!-- ËÆæÁΩÆÂØºËà™È°µÈù¢ -->
        <div id="settings-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeSettings()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">ÊâãÊú∫ËÆæÁΩÆ</span>
                    <div class="header-btn header-btn-right" style="visibility:hidden;"></div>
                </div>
            </div>
            <div class="settings-nav-body">
                <!-- Êó∂Èó¥ËÆæÁΩÆ -->
                <div class="settings-nav-card" style="cursor:default;">
                    <div class="settings-nav-icon" style="background: rgba(255,154,158,0.15);">
                        <div class="settings-nav-icon-img"
                            style="-webkit-mask-image: url('https://api.iconify.design/mdi:clock-outline.svg'); mask-image: url('https://api.iconify.design/mdi:clock-outline.svg'); background-color: #e88a9a;">
                        </div>
                    </div>
                    <div class="settings-nav-text" style="flex:1;">
                        <div class="settings-nav-title">Ëá™ÂÆö‰πâÊó∂Èó¥</div>
                        <div class="settings-nav-subtitle">ËÆæÁΩÆÁä∂ÊÄÅÊ†èÊòæÁ§∫Êó∂Èó¥</div>
                    </div>
                    <input type="text" id="set-custom-time" class="setting-input-sm"
                        style="width: 70px; text-align: center; border: 1px solid #eee; border-radius: 8px; padding: 4px 8px; font-size: 13px;"
                        placeholder="HH:MM">
                </div>

                <!-- Â§ñËßÇËÆæÁΩÆ -->
                <div class="settings-nav-card" onclick="openBeautifySettings()">
                    <div class="settings-nav-icon" style="background: rgba(255,154,158,0.15);">
                        <div class="settings-nav-icon-img"
                            style="-webkit-mask-image: url('https://api.iconify.design/fluent-emoji-high-contrast:artist-palette.svg'); mask-image: url('https://api.iconify.design/fluent-emoji-high-contrast:artist-palette.svg'); background-color: #e88a9a;">
                        </div>
                    </div>
                    <div class="settings-nav-text">
                        <div class="settings-nav-title">Â§ñËßÇËÆæÁΩÆ</div>
                        <div class="settings-nav-subtitle">‰∏ªÈ¢ò ¬∑ ÂõæÊ†á ¬∑ Â≠ó‰Ωì</div>
                    </div>
                    <svg class="settings-nav-arrow" viewBox="0 0 24 24">
                        <path d="M10 6l6 6-6 6" stroke="#ccc" stroke-width="2" fill="none" stroke-linecap="round"
                            stroke-linejoin="round"></path>
                    </svg>
                </div>

                <!-- APIËÆæÁΩÆ -->
                <div class="settings-nav-card" onclick="openApiSettings()">
                    <div class="settings-nav-icon" style="background: rgba(255,154,158,0.15);">
                        <div class="settings-nav-icon-img"
                            style="-webkit-mask-image: url('https://api.iconify.design/ant-design:api-outlined.svg'); mask-image: url('https://api.iconify.design/ant-design:api-outlined.svg'); background-color: #e88a9a;">
                        </div>
                    </div>
                    <div class="settings-nav-text">
                        <div class="settings-nav-title">APIËÆæÁΩÆ</div>
                        <div class="settings-nav-subtitle">ÂØÜÈí• ¬∑ Á´ØÁÇπ ¬∑ ÊñáÊ°£</div>
                    </div>
                    <svg class="settings-nav-arrow" viewBox="0 0 24 24">
                        <path d="M10 6l6 6-6 6" stroke="#ccc" stroke-width="2" fill="none" stroke-linecap="round"
                            stroke-linejoin="round"></path>
                    </svg>
                </div>

                <!-- Êï∞ÊçÆËÆæÁΩÆ -->
                <div class="settings-nav-card" onclick="openDataSettings()">
                    <div class="settings-nav-icon" style="background: rgba(255,154,158,0.15);">
                        <div class="settings-nav-icon-img"
                            style="-webkit-mask-image: url('https://api.iconify.design/material-symbols:database-outline.svg'); mask-image: url('https://api.iconify.design/material-symbols:database-outline.svg'); background-color: #e88a9a;">
                        </div>
                    </div>
                    <div class="settings-nav-text">
                        <div class="settings-nav-title">Êï∞ÊçÆËÆæÁΩÆ</div>
                        <div class="settings-nav-subtitle">Â§á‰ªΩ ¬∑ ÊÅ¢Â§ç ¬∑ Ê∏ÖÈô§</div>
                    </div>
                    <svg class="settings-nav-arrow" viewBox="0 0 24 24">
                        <path d="M10 6l6 6-6 6" stroke="#ccc" stroke-width="2" fill="none" stroke-linecap="round"
                            stroke-linejoin="round"></path>
                    </svg>
                </div>

            </div>
        </div>

        <!-- APIËÆæÁΩÆÂ≠êÈ°µÈù¢ -->
        <div id="api-settings-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeApiSettings()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">APIËÆæÁΩÆ</span>
                </div>
            </div>
            <div class="settings-body">
                <div>
                    <div class="settings-section-title">API ËÆæÁΩÆ</div>
                    <div class="setting-group">
                        <div class="setting-row">
                            <label>API Âú∞ÂùÄ</label>
                            <input type="text" id="set-api-endpoint" class="setting-input"
                                placeholder="https://api.openai.com/v1">
                        </div>
                        <div class="setting-row">
                            <label>API Key</label>
                            <input type="password" id="set-api-key" class="setting-input" placeholder="sk-...">
                        </div>
                        <div class="setting-row">
                            <label>Ê®°Âûã</label>
                            <select id="set-api-model" class="setting-input" style="flex: 1; min-width: 0;">
                                <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label>AI Ê∏©Â∫¶ (Temperature)</label>
                            <div style="display: flex; align-items: center; gap: 10px; flex: 1;">
                                <input type="range" id="set-api-temp" class="setting-range" min="0" max="2" step="0.1"
                                    value="1.0" style="flex: 1;"
                                    oninput="document.getElementById('temp-value-display').textContent = this.value">
                                <span id="temp-value-display"
                                    style="width: 30px; text-align: right; font-size: 13px; color: #666;">1.0</span>
                            </div>
                        </div>
                    </div>
                    <div style="padding: 10px 0; text-align: right;">
                        <button onclick="refreshModelList()" class="action-btn"
                            style="display: inline-block; padding: 6px 16px; white-space: nowrap; background: linear-gradient(135deg, #ff9a9e, #fecfef); color: white; border: none; border-radius: 8px; font-size: 12px; cursor: pointer;">Ëé∑ÂèñÊ®°ÂûãÂàóË°®</button>
                    </div>

                    <div class="setting-group">
                        <div class="setting-row">
                            <label>Ë∞ÉËØïÊ®°Âºè (ÊòæÁ§∫AIÂéüÂßãËæìÂá∫)</label>
                            <div><input type="checkbox" id="set-debug-mode" class="toggle-switch"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="settings-footer" style="padding: 10px;">
                <button class="modal-btn btn-save"
                    style="width: 100%; padding: 8px; border-radius: 12px; font-size: 13px;"
                    onclick="saveApiSettings()">‰øùÂ≠ò</button>
            </div>
        </div>

        <!-- Êï∞ÊçÆËÆæÁΩÆÂ≠êÈ°µÈù¢ -->
        <div id="data-settings-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeDataSettings()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">Êï∞ÊçÆËÆæÁΩÆ</span>
                </div>
            </div>
            <div class="settings-body">
                <div>
                    <div class="settings-section-title">Êï∞ÊçÆÁÆ°ÁêÜ</div>
                    <div class="setting-group">
                        <div class="setting-row" style="cursor:pointer" onclick="exportAllData()">
                            <label style="cursor:pointer">Â§á‰ªΩÊï∞ÊçÆ</label>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />
                            </svg>
                        </div>
                        <div class="setting-row" style="cursor:pointer" onclick="importAllData()">
                            <label style="cursor:pointer">ÊÅ¢Â§çÊï∞ÊçÆ</label>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#999" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" />
                            </svg>
                        </div>
                        <div class="setting-row" style="cursor:pointer" onclick="clearAllData()">
                            <label style="cursor:pointer; color:#e53935;">Ê∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆ</label>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#e53935"
                                stroke-width="2">
                                <path
                                    d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- ÁæéÂåñËÆæÁΩÆÈ°µÈù¢ -->
        <div id="beautify-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeBeautifySettings()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">Â§ñËßÇËÆæÁΩÆ</span>
                </div>
            </div>
            <div class="settings-body">
                <!-- ÂõæÊ†á‰∏éÊñáÂ≠ó -->
                <div>
                    <div class="settings-section-title">ÂõæÊ†á‰∏éÊñáÂ≠ó</div>
                    <div class="setting-group">
                        <div class="setting-row"><label>ÂõæÊ†áÂ∫ïËâ≤</label> <input type="color" id="set-icon-bg"
                                class="color-picker"></div>
                        <div class="setting-row"><label>ÂõæÊ†áÂõæÊ°à</label> <input type="color" id="set-icon-color"
                                class="color-picker"></div>
                        <div class="setting-row"><label>Â≠ó‰ΩìÈ¢úËâ≤</label> <input type="color" id="set-home-text-color"
                                class="color-picker"></div>
                    </div>
                </div>

                <!-- ‰∏ªÂ±èÂπïÂ£ÅÁ∫∏ -->
                <div>
                    <div class="settings-section-title">‰∏ªÂ±èÂπïÂ£ÅÁ∫∏</div>
                    <div class="setting-group">
                        <div class="setting-row"
                            style="display: flex; flex-direction: column; align-items: stretch; gap: 12px; padding: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <label style="font-weight: bold;">ÂΩìÂâçÂ£ÅÁ∫∏È¢ÑËßà</label>
                                <div>
                                    <button class="file-upload-label"
                                        onclick="triggerSettingsUpload('home-bg')">Êú¨Âú∞‰∏ä‰º†</button>
                                    <button class="file-upload-label"
                                        style="margin-left: 5px; background-color: #f0f0f0; color: #333;"
                                        onclick="openUrlUploadModal('home-bg')">url‰∏ä‰º†</button>
                                </div>
                            </div>
                            <div
                                style="background: #f7f7f7; border-radius: 12px; border: 1px solid #eee; display: flex; justify-content: center; align-items: center; padding: 20px;">
                                <img id="preview-home-bg" src=""
                                    style="width: 140px; height: 280px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 2px solid #fff;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ëá™ÂÆö‰πâCSS -->
                <div>
                    <div class="settings-section-title">Ëá™ÂÆö‰πâCSS</div>
                    <div class="setting-group">
                        <style>
                            #set-custom-css::-webkit-scrollbar {
                                display: none;
                            }
                        </style>
                        <textarea id="set-custom-css" class="setting-input"
                            style="height: 200px; font-family: monospace; font-size: 12px; width: 100%; box-sizing: border-box; border: none; resize: vertical; padding: 10px; outline: none; scrollbar-width: none; -ms-overflow-style: none;"
                            placeholder="ËæìÂÖ•CSS‰ª£Á†Å..."></textarea>
                    </div>
                </div>
            </div>
            <div class="settings-footer" style="padding: 10px;">
                <button class="modal-btn btn-save"
                    style="width: 100%; padding: 8px; border-radius: 12px; font-size: 13px;"
                    onclick="saveBeautifySettings()">‰øùÂ≠òÂπ∂Â∫îÁî®</button>
            </div>
        </div>
        <div id="input-modal" class="modal-overlay">
            <div class="modal-box">
                <div class="modal-title" id="modal-title">ËæìÂÖ•ÂÜÖÂÆπ</div>
                <div id="modal-inputs-container"></div>
                <div class="modal-actions"><button class="modal-btn btn-cancel"
                        onclick="closeModal()">ÂèñÊ∂à</button><button class="modal-btn btn-grey"
                        id="modal-confirm-btn">ÂèëÈÄÅ</button></div>
            </div>
        </div>

        <div id="update-modal" class="modal-overlay">
            <div class="modal-box"
                style="background: #fff0f5; border: 3px solid #ffb6c1; border-radius: 25px; box-shadow: 0 10px 30px rgba(255,182,193,0.4);">
                <div class="modal-title"
                    style="color: #ff69b4; font-family: 'Ma Shan Zheng', cursive; font-size: 22px;">Êõ¥Êñ∞Âï¶
                </div>
                <style>
                    #update-content::-webkit-scrollbar {
                        display: none;
                    }
                </style>
                <div id="update-content"
                    style="font-size: 14px; color: #888; line-height: 1.8; max-height: 300px; overflow-y: auto; text-align: left; padding: 15px; white-space: pre-wrap; background: rgba(255,255,255,0.6); border-radius: 15px; margin: 10px 0; scrollbar-width: none; -ms-overflow-style: none;">
                </div>
                <div class="modal-actions">
                    <button class="modal-btn btn-grey" onclick="closeUpdateModal()"
                        style="width: 100%; background: #ffb6c1; color: white; border: none; font-weight: bold; border-radius: 20px;">ÊàëÁü•ÈÅìÂï¶</button>
                </div>
            </div>
        </div>

        <div id="add-contact-modal" class="modal-overlay">
            <div class="modal-box group-modal-cute">
                <div class="modal-title group-modal-title" id="add-contact-title">ÂèëËµ∑ËÅäÂ§©</div>
                <div id="add-contact-private-section">
                    <div class="group-modal-field">
                        <label class="group-modal-label">ÈÄâÊã©ÊàëÁöÑË∫´‰ªΩ</label>
                        <select id="private-chat-user-select" class="group-modal-select"></select>
                    </div>
                    <div class="group-modal-field">
                        <label class="group-modal-label">ÈÄâÊã©ËÅäÂ§©ÂØπË±°</label>
                        <select id="private-chat-npc-select" class="group-modal-select"></select>
                    </div>
                </div>
                <div id="add-contact-group-section" style="display:none">
                    <div class="group-modal-field">
                        <label class="group-modal-label">Áæ§ËÅäÂêçÁß∞</label>
                        <input type="text" id="group-name-input" class="group-modal-input" placeholder="ËæìÂÖ•Áæ§ËÅäÂêçÁß∞">
                    </div>

                    <div class="group-modal-field">
                        <label class="group-modal-label">ÈÄâÊã©Áæ§‰∏ª (User)</label>
                        <select id="group-chat-user-select" class="group-modal-select"></select>
                    </div>

                    <div class="group-modal-field">
                        <div class="group-modal-label-row">
                            <label class="group-modal-label">Áæ§ÊàêÂëò (ËßíËâ≤)</label>
                            <button type="button" class="group-add-role-btn" onclick="addGroupNpcSelect()">
                                <svg viewBox="0 0 24 24" width="14" height="14">
                                    <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2.5"
                                        stroke-linecap="round" />
                                </svg>
                                <span>Ê∑ªÂä†</span>
                            </button>
                        </div>
                        <div id="group-npc-select-list" class="group-npc-select-list">
                            <!-- Âä®ÊÄÅÊ∑ªÂä†ÁöÑËßíËâ≤‰∏ãÊãâÊ°Ü -->
                        </div>
                    </div>
                </div>
                <div class="modal-actions" style="margin-top: 14px; gap: 10px;">
                    <button class="modal-btn group-modal-cancel" onclick="closeAddContactModal()">ÂèñÊ∂à</button>
                    <button class="modal-btn group-modal-confirm" onclick="confirmAddContact()">Á°ÆËÆ§</button>
                </div>
            </div>
        </div>
        <div id="chat-settings-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeChatSettings()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">ËÅäÂ§©ËÆæÁΩÆ</span>
                </div>
            </div>
            <div class="settings-nav-body">
                <!-- Â§¥ÂÉèËÆæÁΩÆ (Moved back) -->
                <div>
                    <div class="settings-section-title">Â§¥ÂÉèËÆæÁΩÆ</div>
                    <div class="setting-group no-border" style="background: transparent; box-shadow: none;">
                        <div id="avatar-settings-container" class="avatar-grid"></div>
                    </div>
                </div>

                <!-- Â§áÊ≥®ËÆæÁΩÆ -->
                <div style="margin-top: 10px;">
                    <div class="settings-section-title">Â§áÊ≥®</div>
                    <div class="setting-group">
                        <div class="setting-row">
                            <label>Â§áÊ≥®Âêç</label>
                            <input type="text" id="set-chat-remark" class="uc-input" placeholder="ËÆæÁΩÆÂ§áÊ≥®Âêç..."
                                style="width: 140px; text-align: right; border: none; background: transparent; font-size: 14px; color: #333;"
                                oninput="saveChatRemarkAuto()">
                        </div>
                    </div>
                </div>

                <!-- ÁæéÂåñËÆæÁΩÆ -->
                <div class="settings-nav-card" onclick="openChatBeautifySettings()">
                    <div class="settings-nav-icon" style="background: rgba(255,154,158,0.15);">
                        <div class="settings-nav-icon-img"
                            style="-webkit-mask-image: url('https://api.iconify.design/fluent-emoji-high-contrast:artist-palette.svg'); mask-image: url('https://api.iconify.design/fluent-emoji-high-contrast:artist-palette.svg'); background-color: #e88a9a;">
                        </div>
                    </div>
                    <div class="settings-nav-text">
                        <div class="settings-nav-title">ÁæéÂåñËÆæÁΩÆ</div>
                        <div class="settings-nav-subtitle">Ê∞îÊ≥° ¬∑ Â≠ó‰Ωì ¬∑ ËÉåÊôØ</div>
                    </div>
                    <svg class="settings-nav-arrow" viewBox="0 0 24 24">
                        <path d="M10 6l6 6-6 6" stroke="#ccc" stroke-width="2" fill="none" stroke-linecap="round"
                            stroke-linejoin="round"></path>
                    </svg>
                </div>

                <!-- ËÆ∞ÂøÜËÆæÁΩÆ -->
                <div class="settings-nav-card" onclick="openChatMemorySettings()">
                    <div class="settings-nav-icon" style="background: rgba(255,154,158,0.15);">
                        <div class="settings-nav-icon-img"
                            style="-webkit-mask-image: url('https://api.iconify.design/material-symbols:memory.svg'); mask-image: url('https://api.iconify.design/material-symbols:memory.svg'); background-color: #e88a9a;">
                        </div>
                    </div>
                    <div class="settings-nav-text">
                        <div class="settings-nav-title">ËÆ∞ÂøÜËÆæÁΩÆ</div>
                        <div class="settings-nav-subtitle">TokenÁªüËÆ° ¬∑ ËÆ∞ÂøÜÊÄªÁªì</div>
                    </div>
                    <svg class="settings-nav-arrow" viewBox="0 0 24 24">
                        <path d="M10 6l6 6-6 6" stroke="#ccc" stroke-width="2" fill="none" stroke-linecap="round"
                            stroke-linejoin="round"></path>
                    </svg>
                </div>

                <!-- Êó∂Âå∫ËÆæÁΩÆ -->
                <div style="margin-top: 10px;">
                    <div class="settings-section-title">Êó∂Âå∫ËÆæÁΩÆ</div>
                    <div class="setting-group">
                        <div class="setting-row">
                            <label>Âêå‰∏ÄÊó∂Âå∫</label>
                            <label class="switch">
                                <input type="checkbox" id="set-char-same-tz" checked onchange="toggleCharTimezone()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div id="char-tz-detail" style="display: none;">
                            <div class="setting-row">
                                <label>Êó∂Â∑Æ</label>
                                <div style="display: flex; align-items: center; gap: 6px;">
                                    <select id="set-char-tz-offset" class="setting-input-sm"
                                        style="width: 120px; text-align: center; border: 1px solid #eee; border-radius: 8px; padding: 4px 6px; font-size: 13px;"
                                        onchange="updateCharTimePreview()">
                                    </select>
                                </div>
                            </div>
                            <div
                                style="display: flex; flex-direction: column; align-items: center; gap: 6px; padding: 8px 0;">
                                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <span style="font-size: 12px; color: #999;">ÊàëÁöÑÊó∂Èó¥Ôºö</span>
                                    <span id="preview-user-tz-time"
                                        style="font-size: 13px; color: #333; font-weight: 500;">--:--</span>
                                </div>
                                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                    <span style="font-size: 12px; color: #999;">ÂØπÊñπÊó∂Èó¥Ôºö</span>
                                    <span id="preview-char-tz-time"
                                        style="font-size: 13px; color: #e88a9a; font-weight: 600;">--:--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÊãâÈªëËÆæÁΩÆ -->
                <div style="margin-top: 10px;">
                    <div class="settings-section-title">ÈöêÁßÅ‰∏éÂÆâÂÖ®</div>
                    <div class="setting-group">
                        <div class="setting-row">
                            <label>ÊãíÊî∂ÂØπÊñπÊ∂àÊÅØ</label>
                            <label class="switch">
                                <input type="checkbox" id="set-block-char" onchange="saveChatBlockSettings()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <label>Ê∂àÊÅØË¢´ÂØπÊñπÊãíÊî∂</label>
                            <label class="switch">
                                <input type="checkbox" id="set-block-user" onchange="saveChatBlockSettings()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- ËßíËâ≤ÊâÆÊºîËÆæÁΩÆ -->
                <div style="margin-top: 10px;">
                    <div class="settings-section-title">ËßíËâ≤ÊâÆÊºî</div>
                    <div class="setting-group">
                        <div class="setting-row">
                            <div style="display:flex; flex-direction:column; gap:2px; flex:1;">
                                <label style="font-size:14px;">Mate Ê®°Âºè</label>
                                <span
                                    style="font-size:11px; color:#aaa; line-height:1.4;">ÂºÄÂêØÂêéÔºåËßíËâ≤Áü•ÈÅìËá™Â∑±ÊòØAIËßíËâ≤ÊâÆÊºîÔºåËÄåÈùûÁúüÂÆûÂ≠òÂú®</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="set-mate-mode" onchange="saveChatMateModeAuto()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        <div class="setting-row">
                            <div style="display:flex; flex-direction:column; gap:2px; flex:1;">
                                <label style="font-size:14px;">ÂøÉÂ£∞Ê®°Âºè</label>
                                <span
                                    style="font-size:11px; color:#aaa; line-height:1.4;">ÂºÄÂêØÂêéÔºåAIÊØèÊ¨°ÂõûÂ§çËá≥Â∞ë‰∏§Êù°Ê∂àÊÅØÊú´Â∞æ‰ºöÈôÑ‰∏äËßíËâ≤ÂÜÖÂøÉÁã¨ÁôΩ</span>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="set-inner-voice-mode"
                                    onchange="saveChatInnerVoiceModeAuto()">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Â™í‰ΩìÁÆ°ÁêÜ (Â∑≤ÁßªÈô§ÔºåÂäüËÉΩÁßªÂä®Ëá≥ÂÖ®Â±ÄËÆæÁΩÆ) -->


                <!-- Êï∞ÊçÆÁÆ°ÁêÜ (Moved back) -->
                <div>
                    <div class="settings-section-title">Êï∞ÊçÆÁÆ°ÁêÜ</div>
                    <div class="setting-group">
                        <div class="setting-row" onclick="exportCurrentChat()" style="cursor: pointer;">
                            <label style="cursor: pointer;">ÂØºÂá∫ËÅäÂ§©ËÆ∞ÂΩï</label>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />
                            </svg>
                        </div>
                        <div class="setting-row" onclick="clearCurrentChatMessages()" style="cursor: pointer;">
                            <label style="cursor: pointer; color: #e53935;">Ê∏ÖÁ©∫ËÅäÂ§©ÂÜÖÂÆπ</label>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#e53935"
                                stroke-width="2">
                                <path
                                    d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" />
                            </svg>
                        </div>
                        <div class="setting-row" onclick="deleteCurrentChat()" style="cursor: pointer;">
                            <label style="cursor: pointer; color: #e53935;">Âà†Èô§ËØ•ËÅäÂ§©</label>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#e53935"
                                stroke-width="2">
                                <path
                                    d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÁæéÂåñËÆæÁΩÆÂ≠êÈ°µÈù¢ -->
        <div id="chat-beautify-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeChatBeautifySettings()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">ÁæéÂåñËÆæÁΩÆ</span>
                </div>
            </div>
            <div class="settings-body">
                <!-- Ê∞îÊ≥°‰∏éÂ≠ó‰Ωì -->
                <div>
                    <div class="settings-section-title">Ê∞îÊ≥°‰∏éÂ≠ó‰Ωì</div>
                    <div class="setting-group">
                        <div class="setting-row"><label>ÂØπÊñπÊ∞îÊ≥°/ÊñáÂ≠ó</label>
                            <div><input type="color" id="set-char-bubble" class="color-picker"> <input type="color"
                                    id="set-char-text" class="color-picker"></div>
                        </div>
                        <div class="setting-row"><label>ÊàëÊñπÊ∞îÊ≥°/ÊñáÂ≠ó</label>
                            <div><input type="color" id="set-user-bubble" class="color-picker"> <input type="color"
                                    id="set-user-text" class="color-picker"></div>
                        </div>
                        <div class="setting-row"><label>Â≠ó‰ΩìÂ§ßÂ∞è</label>
                            <div><input type="number" id="set-font-size" class="setting-input-sm" placeholder="14"
                                    style="width: 60px;"> px</div>
                        </div>
                    </div>
                </div>

                <!-- È¢úËâ≤ËÆæÁΩÆ -->
                <div>
                    <div class="settings-section-title">È¢úËâ≤ËÆæÁΩÆ</div>
                    <div class="setting-group">
                        <div class="setting-row"><label>ÂêçÂ≠ó/Êó∂Èó¥</label>
                            <div><input type="color" id="set-msg-name-color" class="color-picker"> <input type="color"
                                    id="set-msg-time-color" class="color-picker"></div>
                        </div>
                        <div class="setting-row"><label>ÁïåÈù¢</label>
                            <div><input type="color" id="set-interface-color" class="color-picker"></div>
                        </div>
                    </div>
                </div>

                <!-- ÊåâÈíÆËÆæÁΩÆ -->
                <div>
                    <div class="settings-section-title">ÊåâÈíÆËÆæÁΩÆ</div>
                    <div class="setting-group">
                        <div class="setting-row"><label>ÊåâÈíÆÈ¢úËâ≤</label>
                            <div><input type="color" id="set-chat-btn-text" class="color-picker"></div>
                        </div>
                    </div>
                </div>

                <!-- ËÉåÊôØËÆæÁΩÆ -->
                <div>
                    <div class="settings-section-title">ËÉåÊôØËÆæÁΩÆ</div>
                    <div class="setting-group">
                        <div class="setting-row"
                            style="display: flex; flex-direction: column; align-items: stretch; gap: 12px; padding: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <label style="font-weight: bold;">ËÅäÂ§©ËÉåÊôØÈ¢ÑËßà</label>
                                <div><button class="file-upload-label"
                                        onclick="triggerSettingsUpload('chat-bg')">Êú¨Âú∞‰∏ä‰º†</button>
                                    <button class="file-upload-label"
                                        style="margin-left: 5px; background-color: #f0f0f0; color: #333;"
                                        onclick="openUrlUploadModal('chat-bg')">url‰∏ä‰º†</button>
                                </div>
                            </div>
                            <div
                                style="background: #f7f7f7; border-radius: 12px; border: 1px solid #eee; display: flex; justify-content: center; align-items: center; padding: 20px;">
                                <img id="preview-chat-bg" src=""
                                    style="width: 140px; height: 280px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 2px solid #fff;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="settings-footer" style="padding: 10px;">
                <button class="modal-btn btn-save" onclick="saveChatBeautifySettings()"
                    style="width: 100%; border-radius: 12px; padding: 8px 0; box-shadow: none; font-size: 13px;">‰øùÂ≠òÈÖçÁΩÆ</button>
            </div>
        </div>

        <!-- ËÆ∞ÂøÜËÆæÁΩÆÂ≠êÈ°µÈù¢ -->
        <div id="chat-memory-screen" class="screen">
            <div class="app-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeChatMemorySettings()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">ËÆ∞ÂøÜËÆæÁΩÆ</span>
                </div>
            </div>
            <div class="settings-body">
                <!-- Token ÁªüËÆ° -->
                <div>
                    <div class="settings-section-title">Token ÁªüËÆ° (‰º∞ÁÆó)</div>
                    <div class="setting-group">
                        <div class="setting-row">
                            <label>ËßíËâ≤ËÆæÂÆö (Char)</label>
                            <span id="token-char-setup" style="font-size: 13px; color: #888;">0</span>
                        </div>
                        <div class="setting-row">
                            <label>Áî®Êà∑ËÆæÂÆö (User)</label>
                            <span id="token-user-setup" style="font-size: 13px; color: #888;">0</span>
                        </div>
                        <div class="setting-row">
                            <label>ËÅäÂ§©ËÆ∞ÂΩï (Chat)</label>
                            <span id="token-chat-history" style="font-size: 13px; color: #888;">0</span>
                        </div>
                        <div class="setting-row">
                            <label>ËÆ∞ÂøÜÊÄªÁªì (Memory)</label>
                            <span id="token-memory-summary" style="font-size: 13px; color: #888;">0</span>
                        </div>
                        <div class="setting-row">
                            <label>Á≥ªÁªüÊÄªËÆ° (Sys)</label>
                            <span id="token-system-setup" style="font-size: 13px; color: #888;">0</span>
                        </div>
                        <div class="setting-row" style="border-top: 1px solid #f0f0f0;">
                            <label style="font-weight: bold;">ÊÄªËÆ° (Total)</label>
                            <span id="token-total" style="font-weight: bold; font-size: 13px; color: #333;">0</span>
                        </div>
                    </div>
                </div>

                <!-- ËÆ∞ÂøÜÊÄªÁªìËÆæÁΩÆ -->
                <div>
                    <div class="settings-section-title">ÊÄªÁªìËÆæÁΩÆ</div>
                    <div class="setting-group">
                        <div class="setting-row">
                            <div style="display:flex; flex-direction:column; gap:2px; flex:1;">
                                <label style="font-size:14px;">Ê∂àÊÅØ‰øùÁïôÊù°Êï∞</label>
                                <span
                                    style="font-size:11px; color:#aaa; line-height:1.4;">ÊÄªÁªìÂêé‰øùÁïôÊúÄËøëN-5Êù°Ê∂àÊÅØ‰∏çË¢´ÊÄªÁªìÔºåÊúÄËøëNÊù°Ê∂àÊÅØ‰∏çË¢´Âà†Èô§</span>
                            </div>
                            <input type="number" id="memory-keep-count" value="10" min="5" max="100"
                                style="width: 60px; text-align: center; border: 1px solid #ddd; border-radius: 6px; padding: 4px 8px; font-size: 14px;">
                        </div>
                    </div>

                </div>


                <!-- ËÆ∞ÂøÜÊìç‰Ωú -->
                <div>
                    <div class="settings-section-title">ËÆ∞ÂøÜÊìç‰Ωú</div>
                    <div class="setting-group">
                        <div class="setting-row" id="memory-action-buttons-container"
                            style="display: flex; gap: 10px; padding: 12px; align-items: stretch;">
                            <button id="btn-summarize-memory" onclick="summarizeChatMemory()" class="modal-btn"
                                style="flex: 1; border-radius: 8px; background-color: #e8f5e9; color: #2e7d32; padding: 10px; font-size: 13px;">
                                AIËá™Âä®ÊÄªÁªì
                            </button>
                            <button onclick="addMemoryManual()" class="modal-btn"
                                style="flex: 1; border-radius: 8px; background-color: #e3f2fd; color: #1565c0; padding: 10px; font-size: 13px;">
                                ÊâãÂä®Ê∑ªÂä†
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ËÆ∞ÂøÜÂàóË°® -->
                <div>
                    <div class="settings-section-title"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <span>ËÆ∞ÂøÜÊÄªÁªìÂàóË°®</span>
                        <div onclick="toggleMemoryBatchMode()"
                            style="cursor: pointer; padding: 8px; display: flex; align-items: center;" title="ÊâπÈáèÁÆ°ÁêÜ">
                            <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; fill: #888;">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z">
                                </path>
                            </svg>
                        </div>
                    </div>
                    <div id="memory-list-container" class="setting-group">
                        <div class="setting-row"
                            style="justify-content: center; color: #aaa; font-size: 13px; padding: 20px;">
                            ÊöÇÊó†ËÆ∞ÂøÜÊÄªÁªì
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ËÆ∞ÂøÜÁºñËæëÂºπÁ™ó -->
        <div id="memory-edit-modal" class="modal-overlay">
            <div class="modal-box" style="max-width: 360px;">
                <div class="modal-title" id="memory-edit-modal-title">ÁºñËæëËÆ∞ÂøÜ</div>
                <div style="display:flex; flex-direction:column; gap:12px;">
                    <div>
                        <label style="font-size:13px; color:#666; margin-bottom:4px; display:block;">ËÆ∞ÂøÜÊ†áÈ¢ò</label>
                        <input type="text" id="memory-edit-title" class="uc-input" placeholder="Â¶ÇÔºöÁ¨¨‰∏ÄÊ¨°Á∫¶‰ºö">
                    </div>
                    <div>
                        <label style="font-size:13px; color:#666; margin-bottom:4px; display:block;">ËÆ∞ÂøÜÂÜÖÂÆπ</label>
                        <textarea id="memory-edit-content" class="uc-textarea" placeholder="ÊèèËø∞ËøôÊÆµËÆ∞ÂøÜÁöÑÂÖ≥ÈîÆ‰ø°ÊÅØ..."
                            style="min-height: 120px; resize: vertical;"></textarea>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-size:12px; color:#aaa;" id="memory-edit-token-count">0 tokens</span>
                    </div>
                </div>
                <div class="modal-actions" style="justify-content: flex-end; gap: 10px; margin-top:15px;">
                    <button class="modal-btn" onclick="closeMemoryEditModal()"
                        style="background:#f5f5f5; color:#333;">ÂèñÊ∂à</button>
                    <button class="modal-btn btn-confirm" onclick="saveMemoryEntry()">‰øùÂ≠ò</button>
                </div>
            </div>
        </div>

        <div id="call-screen" class="screen"
            style="background: linear-gradient(180deg, #2b2b2b 0%, #1a1a1a 100%); color: #fff; flex-direction: column; align-items: center; justify-content: space-between; padding: 60px 20px 40px 20px; z-index: 100; box-sizing: border-box; display: none;">
            <!-- Top: Name + Timer + Status + Avatar (fixed position) -->
            <div
                style="display: flex; flex-direction: column; align-items: center; gap: 8px; width: 100%; flex-shrink: 0;">
                <div id="call-name" style="font-size: 26px; font-weight: 600; letter-spacing: 1px;"></div>
                <div id="call-timer" style="font-size: 16px; opacity: 0.6; font-variant-numeric: tabular-nums;">
                    00:00</div>
                <div id="call-char-text" style="font-size: 12px; opacity: 0.8;"></div>
                <div style="position: relative; margin-top: 10px;">
                    <img id="call-avatar" src=""
                        style="width: 100px; height: 100px; border-radius: 20px; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);">
                    <div class="ripple-ring"></div>
                </div>
            </div>

            <!-- Middle: Chat bubbles (scrollable, takes remaining space) -->
            <div id="call-chat-container"
                style="width: 100%; padding: 10px; box-sizing: border-box; display: flex; flex-direction: column; gap: 10px; flex: 1; overflow-y: auto; scrollbar-width: none; -ms-overflow-style: none; margin-top: 15px;">
                <!-- Call bubbles will be injected here -->
            </div>
            <style>
                #call-chat-container::-webkit-scrollbar {
                    display: none;
                }

                .call-bubble {
                    max-width: 80%;
                    padding: 8px 12px;
                    border-radius: 16px;
                    font-size: 14px;
                    line-height: 1.4;
                    word-break: break-word;
                    animation: fadeIn 0.3s ease;
                }

                .call-bubble.sent {
                    align-self: flex-end;
                    background: #666666;
                    color: #fff;
                    border-bottom-right-radius: 4px;
                }

                .call-bubble.received {
                    align-self: flex-start;
                    background: #333333;
                    color: #fff;
                    border-bottom-left-radius: 4px;
                }

                @keyframes fadeIn {
                    from {
                        opacity: 0;
                        transform: translateY(5px);
                    }

                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }

                @keyframes jump-exclamation {

                    0%,
                    100% {
                        transform: translateY(0);
                    }

                    50% {
                        transform: translateY(-5px);
                    }
                }

                .jumping-exclamation {
                    display: inline-block;
                    font-weight: bold;
                    font-size: 18px;
                    animation: jump-exclamation 0.6s infinite;
                }
            </style>

            <div style="width: 100%; display: flex; flex-direction: column; gap: 30px;">
                <div
                    style="display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.1); padding: 5px; border-radius: 25px; backdrop-filter: blur(10px);">
                    <input type="text" id="call-input" placeholder="ÊàëÊÉ≥ËØ¥..."
                        style="flex: 1; height: 32px; line-height: 32px; padding: 0 15px; border-radius: 20px; border: none; outline: none; background: transparent; color: #fff; font-size: 15px; margin-top: 6px;">
                    <button onclick="sendCallMessage()"
                        style="width: 32px; height: 32px; border-radius: 50%; border: none; background: #333; color: #888; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: opacity 0.2s; padding: 0; margin-left: 5px;">
                        <div
                            style="width: 20px; height: 20px; background-color: currentColor; -webkit-mask: url('https://api.iconify.design/typcn:phone.svg') no-repeat center / contain; mask: url('https://api.iconify.design/typcn:phone.svg') no-repeat center / contain;">
                        </div>
                    </button>
                </div>

                <div style="display: flex; justify-content: space-around; align-items: center;">
                    <div
                        style="display: flex; flex-direction: column; align-items: center; gap: 8px; opacity: 0.5; cursor: not-allowed;">
                        <div
                            style="width: 64px; height: 64px; border-radius: 50%; background: rgba(255,255,255,0.15); display: flex; align-items: center; justify-content: center;">
                            <svg viewBox="0 0 24 24" width="28" height="28" fill="#fff">
                                <path
                                    d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                                <path
                                    d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                            </svg>
                        </div>
                        <span style="font-size: 12px; font-weight: 500;">ÂΩïÈü≥</span>
                    </div>

                    <div onclick="endVoiceCall()"
                        style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: transform 0.1s;">
                        <div
                            style="width: 64px; height: 64px; border-radius: 50%; background: #ff3b30; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(255, 59, 48, 0.3);">
                            <img src="https://api.iconify.design/majesticons:phone-hangup.svg?color=white" width="32"
                                height="32">
                        </div>
                        <span style="font-size: 12px; font-weight: 500;">ÊåÇÊñ≠</span>
                    </div>
                </div>
            </div>
            <style>
                @keyframes ripple {
                    0% {
                        transform: scale(1);
                        opacity: 0.4;
                    }

                    100% {
                        transform: scale(1.5);
                        opacity: 0;
                    }
                }

                .ripple-ring {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    border-radius: 20px;
                    border: 2px solid rgba(255, 255, 255, 0.5);
                    animation: ripple 2s infinite;
                    z-index: -1;
                    display: none;
                }

                #call-screen.speaking .ripple-ring {
                    display: block;
                }

                @keyframes wave-jump {

                    0%,
                    100% {
                        transform: translateY(0);
                    }

                    50% {
                        transform: translateY(-5px);
                    }
                }

                .jumping-dot {
                    display: inline-block;
                    animation: wave-jump 1s infinite;
                    font-size: 32px;
                    /* ÁÇπÂ§ß‰∏Ä‰∫õ */
                    margin: 0 4px;
                    /* Ë∑ùÁ¶ªÂÆΩ‰∏Ä‰∫õ */
                    line-height: 10px;
                    /* Èò≤Ê≠¢ÊíëÂºÄÈ´òÂ∫¶ */
                }

                .jumping-dot:nth-child(1) {
                    animation-delay: 0s;
                }

                .jumping-dot:nth-child(2) {
                    animation-delay: 0.1s;
                }

                .jumping-dot:nth-child(3) {
                    animation-delay: 0.2s;
                }
            </style>
        </div>

        <div id="incoming-call-screen" class="screen"
            style="display:none; background: linear-gradient(180deg, #2b2b2b 0%, #1a1a1a 100%); color: #fff; flex-direction: column; align-items: center; justify-content: space-between; padding: 60px 20px 80px 20px; z-index: 110;">
            <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                <div id="incoming-call-name" style="font-size: 26px; font-weight: 600;"></div>
                <div style="font-size: 16px; opacity: 0.6;">ÈÇÄËØ∑‰Ω†ËøõË°åËØ≠Èü≥ÈÄöËØù...</div>
            </div>

            <div style="position: relative;">
                <img id="incoming-call-avatar" src=""
                    style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                <div class="ripple-ring" style="display:block;"></div>
            </div>

            <div style="width: 100%; display: flex; justify-content: space-around; align-items: center;">
                <div onclick="declineIncomingCall()"
                    style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                    <div
                        style="width: 64px; height: 64px; border-radius: 50%; background: #ff3b30; display: flex; align-items: center; justify-content: center;">
                        <img src="https://api.iconify.design/majesticons:phone-hangup.svg?color=white" width="32"
                            height="32">
                    </div>
                    <span style="font-size: 12px;">ÊãíÁªù</span>
                </div>

                <div onclick="acceptIncomingCall()"
                    style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                    <div
                        style="width: 64px; height: 64px; border-radius: 50%; background: #30d158; display: flex; align-items: center; justify-content: center;">
                        <img src="https://api.iconify.design/majesticons:phone.svg?color=white" width="32" height="32">
                    </div>
                    <span style="font-size: 12px;">Êé•Âê¨</span>
                </div>
            </div>
        </div>

        <div id="cropper-modal" class="modal-overlay" style="z-index: 300;">
            <div class="modal-box"
                style="width: 90%; height: 80%; max-width: 500px; max-height: 800px; padding: 0; background: #000; display: flex; flex-direction: column;">
                <div style="flex: 1; position: relative; overflow: hidden; background: #333;">
                    <img id="cropper-image" src="" style="max-width: 100%; display: block;">
                </div>
                <div class="modal-actions"
                    style="padding: 15px; background: #fff; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; justify-content: space-between;">
                    <button class="modal-btn btn-cancel" onclick="closeCropper()">ÂèñÊ∂à</button>
                    <button class="modal-btn btn-confirm" onclick="confirmCrop()">Ë£ÅÂâ™Âπ∂‰ΩøÁî®</button>
                </div>
            </div>
        </div>

        <!-- Character Setup Screen - NPCÂàóË°® -->
        <div id="character-setup-screen" class="screen">
            <div class="app-header pink-header">
                <div class="header-content">
                    <div class="header-btn" onclick="goBack()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">ËßíËâ≤ËÆæÁΩÆ</span>
                    <div class="header-btn header-btn-right" onclick="openNpcCreatePage()"><svg viewBox="0 0 24 24">
                            <path d="M12 5v14M5 12h14" stroke="#181818" stroke-width="2" stroke-linecap="round"></path>
                        </svg></div>
                </div>
            </div>
            <div id="npc-list-container" class="pink-scroll-area"></div>
        </div>

        <!-- NPC Create/Edit Screen (ÂÖ®È°µÈù¢Ôºå‰∏éUserÂàõÂª∫È°µÈù¢‰∏ÄËá¥) -->
        <div id="npc-create-screen" class="screen">
            <div class="app-header pink-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeNpcCreatePage()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title" id="npc-create-title">ÂàõÂª∫ËßíËâ≤</span>
                    <div class="header-btn header-btn-right" onclick="saveNpc()">
                        <span style="font-size: 14px; color: #e398b1; font-weight: bold;">‰øùÂ≠ò</span>
                    </div>
                </div>
            </div>
            <div class="user-create-body pink-scroll-area">
                <!-- Â§¥ÂÉè -->
                <div class="uc-avatar-section">
                    <img id="npc-avatar-preview" class="uc-avatar"
                        src="data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23d1d1d6'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E"
                        onclick="document.getElementById('npc-avatar-input').click()">
                    <input type="file" id="npc-avatar-input" accept="image/*" style="display:none">
                    <div class="uc-avatar-hint">ÁÇπÂáªÊõ¥Êç¢Â§¥ÂÉè <span
                            style="color: #e398b1; cursor: pointer; margin-left: 5px; font-weight: bold;"
                            onclick="event.stopPropagation(); openUrlUploadModal('npc-avatar')">url‰∏ä‰º†</span></div>
                </div>

                <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                <div class="uc-card">
                    <div class="uc-field">
                        <label>ÂßìÂêç</label>
                        <input type="text" id="npc-name-input-page" class="uc-input" placeholder="ËßíËâ≤ÂêçÂ≠ó">
                    </div>
                    <div class="uc-field">
                        <label>ÊòµÁß∞</label>
                        <input type="text" id="npc-nickname-input-page" class="uc-input" placeholder="ÊòµÁß∞/Âà´ÂêçÔºàÂèØÈÄâÔºâ">
                    </div>
                    <div class="uc-field">
                        <label>ÊÄßÂà´</label>
                        <div class="uc-gender-group">
                            <label class="uc-gender-option selected" data-value="female">
                                <input type="radio" name="npc-gender-page" value="female" checked> Â•≥
                            </label>
                            <label class="uc-gender-option" data-value="male">
                                <input type="radio" name="npc-gender-page" value="male"> Áî∑
                            </label>
                        </div>
                    </div>
                </div>

                <!-- ‰∫∫ËÆæ -->
                <div class="uc-card">
                    <div class="uc-field">
                        <div class="uc-field-header">
                            <label>‰∫∫ËÆæ</label>
                            <span class="uc-token-count" id="npc-desc-token">0 tokens</span>
                        </div>
                        <textarea id="npc-desc-input-page" class="uc-textarea"
                            placeholder="ÊèèËø∞ËßíËâ≤ÁöÑÊÄßÊ†º„ÄÅÂ§ñË≤å„ÄÅËÉåÊôØÊïÖ‰∫ã..."></textarea>
                    </div>
                </div>

                <!-- ‰∏ñÁïå‰π¶ -->
                <div class="uc-card">
                    <div class="uc-field">
                        <label>‰∏ñÁïå‰π¶</label>
                        <div id="npc-worldbook-select" class="wb-select-container">
                            <div class="wb-option-empty">ÊöÇÊó†‰∏ñÁïå‰π¶</div>
                        </div>
                        <div class="uc-hint">ÈÄâÊã©‰∏Ä‰∏™‰∏ñÁïå‰π¶Êù•ËÆæÂÆöÊïÖ‰∫ãËÉåÊôØ</div>
                    </div>
                </div>

                <!-- Â≠êNPCÂàóË°® -->
                <div class="uc-card">
                    <div class="uc-field">
                        <div class="uc-field-header">
                            <label>ÂÖ≥ËÅîNPC</label>
                            <button class="uc-add-npc-btn" onclick="addSubNpcToNpc()">+ Ê∑ªÂä†NPC</button>
                        </div>
                        <div id="npc-sub-npc-list" class="uc-npc-list">
                        </div>
                    </div>
                </div>

                <div style="height: 30px;"></div>
            </div>
        </div>
        <!-- World Book List Screen -->
        <div id="worldbook-list-screen" class="screen">
            <div class="app-header pink-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeWorldbookList()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">‰∏ñÁïå‰π¶</span>
                    <div class="header-btn header-btn-right" onclick="openWorldbookEdit(null)"><svg viewBox="0 0 24 24">
                            <path d="M12 5v14M5 12h14" stroke="#181818" stroke-width="2" stroke-linecap="round"></path>
                        </svg></div>
                </div>
            </div>
            <div id="worldbook-list-container" class="pink-scroll-area"></div>
        </div>

        <!-- World Book Edit Screen -->
        <div id="worldbook-edit-screen" class="screen">
            <div class="app-header pink-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeWorldbookEdit()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title" id="worldbook-edit-title">Êñ∞Âª∫‰∏ñÁïå‰π¶</span>
                    <div class="header-btn header-btn-right" onclick="saveWorldBookData()">
                        <span style="font-size: 14px; color: #e398b1; font-weight: bold;">‰øùÂ≠ò</span>
                    </div>
                </div>
            </div>
            <div class="user-create-body pink-scroll-area">
                <div class="uc-card">
                    <div class="uc-field">
                        <label>‰∏ñÁïå‰π¶ÂêçÁß∞</label>
                        <input type="text" id="worldbook-name-input" class="uc-input" placeholder="ËæìÂÖ•‰∏ñÁïå‰π¶ÂêçÁß∞">
                    </div>
                </div>

                <div class="uc-card">
                    <div class="uc-field">
                        <div class="uc-field-header">
                            <label>Êù°ÁõÆÂàóË°®</label>
                            <button class="uc-add-npc-btn" onclick="addWorldbookEntry()">+ Ê∑ªÂä†Êù°ÁõÆ</button>
                        </div>
                        <div id="worldbook-entries-container"></div>
                    </div>
                </div>

                <div style="height: 30px;"></div>
            </div>
        </div>

        <!-- User Settings Screen (UserÂàóË°®) -->
        <div id="user-settings-screen" class="screen">
            <div class="app-header pink-header">
                <div class="header-content">
                    <div class="header-btn" onclick="goBack()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title">ÊàëÁöÑËßíËâ≤</span>
                    <div class="header-btn header-btn-right" onclick="openUserCreatePage()"><svg viewBox="0 0 24 24">
                            <path d="M12 5v14M5 12h14" stroke="#181818" stroke-width="2" stroke-linecap="round"></path>
                        </svg></div>
                </div>
            </div>
            <div id="user-list-container" class="pink-scroll-area"></div>
        </div>

        <!-- User Create/Edit Screen (ÂÖ®È°µÈù¢) -->
        <div id="user-create-screen" class="screen">
            <div class="app-header pink-header">
                <div class="header-content">
                    <div class="header-btn" onclick="closeUserCreatePage()"><svg viewBox="0 0 24 24">
                            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                        </svg></div>
                    <span class="header-title" id="user-create-title">ÂàõÂª∫ËßíËâ≤</span>
                    <div class="header-btn header-btn-right" onclick="saveUser()">
                        <span style="font-size: 14px; color: #e398b1; font-weight: bold;">‰øùÂ≠ò</span>
                    </div>
                </div>
            </div>
            <div class="user-create-body pink-scroll-area">
                <!-- Â§¥ÂÉè -->
                <div class="uc-avatar-section">
                    <img id="user-avatar-preview" class="uc-avatar"
                        src="data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23d1d1d6'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E"
                        onclick="document.getElementById('user-avatar-input').click()">
                    <input type="file" id="user-avatar-input" accept="image/*" style="display:none">
                    <div class="uc-avatar-hint">ÁÇπÂáªÊõ¥Êç¢Â§¥ÂÉè <span
                            style="color: #e398b1; cursor: pointer; margin-left: 5px; font-weight: bold;"
                            onclick="event.stopPropagation(); openUrlUploadModal('user-avatar')">url‰∏ä‰º†</span></div>
                </div>

                <!-- Âü∫Êú¨‰ø°ÊÅØ -->
                <div class="uc-card">
                    <div class="uc-field">
                        <label>ÊòµÁß∞</label>
                        <input type="text" id="user-name-input" class="uc-input" placeholder="ÁªôËßíËâ≤Ëµ∑‰∏™ÂêçÂ≠óÂêß~">
                    </div>
                    <div class="uc-field">
                        <label>ÊÄßÂà´</label>
                        <div class="uc-gender-group">
                            <label class="uc-gender-option selected" data-value="female">
                                <input type="radio" name="user-gender" value="female" checked> Â•≥
                            </label>
                        </div>
                        <input type="hidden" name="user-gender" value="female">
                    </div>
                </div>

                <!-- ‰∫∫ËÆæ -->
                <div class="uc-card">
                    <div class="uc-field">
                        <div class="uc-field-header">
                            <label>‰∫∫ËÆæ</label>
                            <span class="uc-token-count" id="user-desc-token">0 tokens</span>
                        </div>
                        <textarea id="user-desc-input" class="uc-textarea" placeholder="ÊèèËø∞ËßíËâ≤ÁöÑÊÄßÊ†º„ÄÅÂ§ñË≤å„ÄÅËÉåÊôØÊïÖ‰∫ã..."></textarea>
                    </div>
                </div>

                <!-- ‰∏ñÁïå‰π¶ -->
                <div class="uc-card">
                    <div class="uc-field">
                        <label>‰∏ñÁïå‰π¶</label>
                        <div id="user-worldbook-select" class="wb-select-container">
                            <div class="wb-option-empty">ÊöÇÊó†‰∏ñÁïå‰π¶</div>
                        </div>
                        <div class="uc-hint">ÈÄâÊã©‰∏Ä‰∏™‰∏ñÁïå‰π¶Êù•ËÆæÂÆöÊïÖ‰∫ãËÉåÊôØ</div>
                    </div>
                </div>

                <!-- NPCÂàóË°® -->
                <div class="uc-card">
                    <div class="uc-field">
                        <div class="uc-field-header">
                            <label>NPC ËßíËâ≤</label>
                            <button class="uc-add-npc-btn" onclick="addNpcToUser()">+ Ê∑ªÂä†NPC</button>
                        </div>
                        <div id="user-npc-list" class="uc-npc-list">
                            <!-- NPC cards will be dynamically added here -->
                        </div>
                    </div>
                </div>

                <div style="height: 30px;"></div>
            </div>
        </div>

    </div>

    <div id="add-action-sheet-overlay" class="action-sheet-overlay" onclick="hideAddActionSheet()"></div>
    <div id="add-action-sheet" class="action-popup">
        <div class="action-popup-item" onclick="openAddContactModal('private')">
            <div class="action-popup-icon"><svg viewBox="0 0 24 24">
                    <path
                        d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" />
                </svg></div>
            <span>ÂèëËµ∑ÁßÅËÅä</span>
        </div>
        <div class="action-popup-item" onclick="openAddContactModal('group')">
            <div class="action-popup-icon"><svg viewBox="0 0 24 24">
                    <path
                        d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
                </svg></div>
            <span>ÂèëËµ∑Áæ§ËÅä</span>
        </div>
    </div>

    <script src="script.js"></script>

    <!-- URL Upload Modal -->
    <div id="url-upload-modal" class="modal-overlay" style="display:none; z-index: 500;">
        <div class="modal-box"
            style="width: 85%; max-width: 320px; padding: 20px; background-color: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
            <h3 style="margin-top:0; margin-bottom: 15px; font-size: 18px;">url‰∏ä‰º†</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 10px; line-height: 1.5;">
                ËæìÂÖ• Catbox ÂêéÁºÄ (Â¶Ç 31onrh.jpeg) ÊàñÂÆåÊï¥ URL ÈìæÊé•„ÄÇ
                <br>
            </p>
            <input type="text" id="url-upload-input" class="uc-input" placeholder="ËæìÂÖ•ÂêéÁºÄÊàñÈìæÊé•..."
                style="margin-bottom: 15px;">
            <div class="modal-actions" style="justify-content: flex-end; gap: 10px;">
                <button class="modal-btn" onclick="closeUrlUploadModal()"
                    style="background:#f5f5f5; color:#333;">ÂèñÊ∂à</button>
                <button class="modal-btn btn-confirm" onclick="confirmUrlUpload()">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>
    <!-- Regex Settings Screen -->
    <div id="regex-screen" class="screen">
        <div class="app-header">
            <div class="header-content">
                <div class="header-btn" onclick="closeRegexScreen()"><svg viewBox="0 0 24 24">
                        <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
                    </svg></div>
                <span class="header-title">Ê≠£ÂàôËÑöÊú¨</span>
                <div class="header-btn header-btn-right" onclick="addNewRegexRule()"><svg viewBox="0 0 24 24">
                        <path d="M12 5v14M5 12h14" stroke="#181818" stroke-width="2" stroke-linecap="round"></path>
                    </svg></div>
            </div>
        </div>
        <div class="settings-body" id="regex-list-container">
            <!-- Regex rules will be rendered here by JS -->
        </div>
    </div>

    <!-- Regex Edit Modal -->
    <div id="regex-edit-modal" class="modal-overlay">
        <div class="modal-box" style="max-width: 340px;">
            <div class="modal-title" id="regex-edit-modal-title">ÁºñËæëÊ≠£Âàô</div>
            <div style="display:flex; flex-direction:column; gap:12px;">
                <div>
                    <label style="font-size:13px; color:#666; margin-bottom:4px; display:block;">ËßÑÂàôÂêçÁß∞</label>
                    <input type="text" id="regex-edit-name" class="uc-input" placeholder="Â¶ÇÔºöÂéªÈô§ÊòüÂè∑">
                </div>
                <div>
                    <label style="font-size:13px; color:#666; margin-bottom:4px; display:block;">Ê≠£ÂàôË°®ËææÂºè</label>
                    <input type="text" id="regex-edit-pattern" class="uc-input" placeholder="Â¶ÇÔºö\*([^*]+)\*">
                </div>
                <div>
                    <label style="font-size:13px; color:#666; margin-bottom:4px; display:block;">ÊõøÊç¢ÂÜÖÂÆπ</label>
                    <input type="text" id="regex-edit-replace" class="uc-input" placeholder="Â¶ÇÔºö$1 (ÁïôÁ©∫ÂàôÂà†Èô§ÂåπÈÖç)">
                </div>
                <div style="display:flex; gap:20px; align-items:center; padding:4px 0;">
                    <label
                        style="display:flex; align-items:center; gap:6px; font-size:13px; color:#333; cursor:pointer;">
                        <input type="checkbox" id="regex-edit-user" style="width:16px; height:16px;"> userËæìÂÖ•
                    </label>
                    <label
                        style="display:flex; align-items:center; gap:6px; font-size:13px; color:#333; cursor:pointer;">
                        <input type="checkbox" id="regex-edit-ai" checked style="width:16px; height:16px;"> AIËæìÂá∫
                    </label>
                </div>
            </div>
            <div class="modal-actions" style="justify-content: flex-end; gap: 10px; margin-top:15px;">
                <button class="modal-btn" onclick="closeRegexEditModal()"
                    style="background:#f5f5f5; color:#333;">ÂèñÊ∂à</button>
                <button class="modal-btn btn-confirm" onclick="saveRegexRule()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

</body>

</html>
